{"filter":false,"title":"iam.tf","tooltip":"/terraform/iam.tf","undoManager":{"mark":0,"position":0,"stack":[[{"start":{"row":0,"column":2},"end":{"row":52,"column":18},"action":"insert","lines":["Documentos de políticas (no crean recursos por sí solos)","","# Trust policy para que Lambda asuma el rol (solo se usa si manage_iam=true)","data \"aws_iam_policy_document\" \"lambda_assume\" {","  statement {","    effect = \"Allow\"","    principals {","      type        = \"Service\"","      identifiers = [\"lambda.amazonaws.com\"]","    }","    actions = [\"sts:AssumeRole\"]","  }","}","","# Policy mínima para Lambda: leer CSV del bucket ingest, escribir resultados en website, y logs","data \"aws_iam_policy_document\" \"lambda_policy\" {","  statement {","    sid    = \"S3ReadIngest\"","    effect = \"Allow\"","    actions = [","      \"s3:GetObject\",","      \"s3:ListBucket\",","    ]","    resources = [","      \"arn:aws:s3:::${var.ingest_bucket_name}\",","      \"arn:aws:s3:::${var.ingest_bucket_name}/*\",","    ]","  }","","  statement {","    sid    = \"S3WriteWebsite\"","    effect = \"Allow\"","    actions = [","      \"s3:PutObject\",","    ]","    resources = [","      \"arn:aws:s3:::${var.website_bucket_name}/${var.results_prefix}/*\",","    ]","  }","","  statement {","    sid    = \"CloudWatchLogs\"","    effect = \"Allow\"","    actions = [","      \"logs:CreateLogGroup\",","      \"logs:CreateLogStream\",","      \"logs:PutLogEvents\",","    ]","    resources = [\"*\"]","  }","}","","# ====== Recursos "],"id":2},{"start":{"row":52,"column":22},"end":{"row":52,"column":31},"action":"insert","lines":["(solo se "]},{"start":{"row":52,"column":35},"end":{"row":52,"column":51},"action":"insert","lines":["n si manage_iam="]},{"start":{"row":52,"column":52},"end":{"row":54,"column":14},"action":"insert","lines":["rue) ======","","resource \"aws_"]},{"start":{"row":54,"column":15},"end":{"row":54,"column":19},"action":"insert","lines":["am_r"]},{"start":{"row":54,"column":20},"end":{"row":55,"column":5},"action":"insert","lines":["le\" \"lambda_role\" {","  cou"]},{"start":{"row":55,"column":6},"end":{"row":55,"column":7},"action":"insert","lines":["t"]},{"start":{"row":55,"column":8},"end":{"row":55,"column":25},"action":"insert","lines":["             = va"]},{"start":{"row":55,"column":26},"end":{"row":55,"column":32},"action":"insert","lines":[".manag"]},{"start":{"row":55,"column":33},"end":{"row":55,"column":36},"action":"insert","lines":["_ia"]},{"start":{"row":55,"column":37},"end":{"row":56,"column":32},"action":"insert","lines":[" ? 1 : 0","  name               = \"${var.pr"]},{"start":{"row":56,"column":33},"end":{"row":59,"column":16},"action":"insert","lines":["ject_name}-lambda-role\"","  assume_role_policy = data.aws_iam_policy_document.lambda_assume.json","  tags = {","    Project   = "]},{"start":{"row":59,"column":17},"end":{"row":60,"column":9},"action":"insert","lines":["ar.project_name","    Manag"]},{"start":{"row":60,"column":11},"end":{"row":60,"column":13},"action":"insert","lines":["By"]},{"start":{"row":60,"column":14},"end":{"row":60,"column":15},"action":"remove","lines":["—"]},{"start":{"row":60,"column":14},"end":{"row":67,"column":0},"action":"insert","lines":["= \"Terraform\"","  }","}","","resource \"aws_iam_policy\" \"lambda_policy\" {","  count       = var.manage_iam ? 1 : 0","  name        = \"${var.project_name}-lambda-policy\"",""]},{"start":{"row":67,"column":1},"end":{"row":67,"column":2},"action":"remove","lines":["U"]},{"start":{"row":67,"column":1},"end":{"row":67,"column":32},"action":"insert","lines":[" description = \"Permisos mínimo"]},{"start":{"row":67,"column":33},"end":{"row":67,"column":50},"action":"insert","lines":[" para Lambda (S3 "]},{"start":{"row":67,"column":53},"end":{"row":67,"column":56},"action":"insert","lines":["est"]},{"start":{"row":67,"column":57},"end":{"row":67,"column":58},"action":"insert","lines":["r"]},{"start":{"row":67,"column":59},"end":{"row":67,"column":60},"action":"remove","lines":["x"]},{"start":{"row":67,"column":59},"end":{"row":67,"column":70},"action":"insert","lines":["ad, S3 webs"]},{"start":{"row":67,"column":71},"end":{"row":67,"column":84},"action":"insert","lines":["te write, log"]},{"start":{"row":67,"column":85},"end":{"row":68,"column":18},"action":"insert","lines":[")\"","  policy      = da"]},{"start":{"row":68,"column":19},"end":{"row":68,"column":25},"action":"insert","lines":["a.aws_"]},{"start":{"row":68,"column":26},"end":{"row":68,"column":42},"action":"insert","lines":["am_policy_docume"]},{"start":{"row":68,"column":43},"end":{"row":69,"column":4},"action":"insert","lines":["t.lambda_policy.json","  ta"]},{"start":{"row":69,"column":5},"end":{"row":69,"column":6},"action":"insert","lines":["s"]},{"start":{"row":69,"column":7},"end":{"row":69,"column":8},"action":"remove","lines":["L"]},{"start":{"row":69,"column":7},"end":{"row":70,"column":17},"action":"insert","lines":["= {","    Project   = v"]},{"start":{"row":70,"column":18},"end":{"row":75,"column":46},"action":"insert","lines":["r.project_name","    ManagedBy = \"Terraform\"","  }","}","","resource \"aws_iam_role_policy_attachment\" \"lam"]},{"start":{"row":75,"column":47},"end":{"row":75,"column":48},"action":"remove","lines":["R"]},{"start":{"row":75,"column":47},"end":{"row":77,"column":3},"action":"insert","lines":["da_attach\" {","  count      = var.manage_iam ? 1 : 0","  r"]},{"start":{"row":77,"column":6},"end":{"row":79,"column":1},"action":"insert","lines":["       = aws_iam_role.lambda_role[0].name","  policy_arn = aws_iam_policy.lambda_policy[0].arn","}"]}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":80,"column":0},"end":{"row":80,"column":0},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1754746993883,"hash":"ad0d05c1d7a801b7038420e359f5774ee9313389"}