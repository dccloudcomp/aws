{"filter":false,"title":"lambda.tf","tooltip":"/terraform/lambda.tf","undoManager":{"mark":0,"position":0,"stack":[[{"start":{"row":0,"column":0},"end":{"row":46,"column":0},"action":"insert","lines":["# Paquete zip creado por build.sh","locals {","  lambda_zip_path = \"${path.module}/lambda_package/dist/function.zip\"","}","","resource \"aws_lambda_function\" \"processor\" {","  function_name = \"${var.project_name}-processor\"","  role          = aws_iam_role.lambda_role.arn","  handler       = \"main.handler\"","  runtime       = \"python3.11\"","  filename      = local.lambda_zip_path","  timeout       = 120","  memory_size   = 512","  environment {","    variables = {","      INGEST_BUCKET     = aws_s3_bucket.ingest.id","      WEBSITE_BUCKET    = aws_s3_bucket.website.id","      RESULTS_PREFIX    = var.results_prefix","      HF_API_TOKEN      = var.hf_api_token","      HF_MODEL_ID       = var.hf_model_id","      CSV_SUFFIX        = var.csv_suffix","    }","  }","}","","# Permitir a S3 invocar la lambda","resource \"aws_lambda_permission\" \"allow_s3\" {","  statement_id  = \"AllowExecutionFromS3\"","  action        = \"lambda:InvokeFunction\"","  function_name = aws_lambda_function.processor.function_name","  principal     = \"s3.amazonaws.com\"","  source_arn    = aws_s3_bucket.ingest.arn","}","","# Notificación S3 → Lambda","resource \"aws_s3_bucket_notification\" \"ingest_trigger\" {","  bucket = aws_s3_bucket.ingest.id","","  lambda_function {","    lambda_function_arn = aws_lambda_function.processor.arn","    events              = [\"s3:ObjectCreated:*\"]","    filter_suffix       = var.csv_suffix","  }","","  depends_on = [aws_lambda_permission.allow_s3]","}",""],"id":1}]]},"ace":{"folds":[],"scrolltop":517,"scrollleft":0,"selection":{"start":{"row":46,"column":0},"end":{"row":46,"column":0},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":35,"state":"start","mode":"ace/mode/terraform"}},"timestamp":1754664394952,"hash":"e0ac1c9c93b5b897eba401e2c8aaa33a746414f1"}